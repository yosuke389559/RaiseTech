# 第７回  
## セキュリティ対策  

### 基礎
+ **セキュリティリスクへの理解**、**リスク対策の決定** が必要  
+ 基本原則は、想定されるリスクを洗い出すし、それに対する対応方針を定義する  
+ 対応方針（アクション）  
 1. 受容  
 そのまま受け入れて対策は行わない  
 2. 低減  
 影響を減らすような対策を行う  
 3. 移転（転嫁）  
 リスク管理を当事者以外に任せる  
 4. 回避  
リスク自体を発生させないようにする  
+ 想定されるリスクとしては、**盗難**、**改ざん**、**破壊**、であり、以下３項目が共通要因である  
 1. 脆弱性  
 バグや設定不備によるシステムの弱点、穴を意味する  
 2. 認証情報の流出  
 誤って公開の場（GitHub等）にアップロードした情報を収集している攻撃者が同情報でログインを試みる  
 3. 人為的な過負荷  
 多数のコンピュータから連続でリクエストを送り停止に追い込む  

### セキュリティ対策の主体
 + あくまで最終責任は事業責任者にある  
 + 全体コントロール、想定リスクの洗い出しを事業責任者が行い、対策についてエンジニアから知見を借りるというのが本来の姿  
 + 上記は理想論であるため、最終判断は事業責任者という相手との合意は必須  

### 脆弱性  
+ アプリケーション、OS・ミドルウェア、ネットワーク、アプリケーションコードや機能追加のため使用するモジュール、ライブラリが対象と言える  
+ AWSでの脆弱性対策  
 1. CodeGuru Reviewr  
 AIによりGitHub等のリポジトリにあるコードをスキャン、改善を提案してくれる  
 2. WAF、OWASP  
 Webアプリケーションは仕組み上抱えている脆弱性がある  
 Webアプリケーションに対する攻撃手法と対策方法は**OWASP**がトップ１０を公開している  
 Web Application FirewallをAWSも提供しているが、アプリケーション側でも対処する必要はある  
 ELB、 CloudFrontにルールを設置する  
 ルールグループはAWSManagedRulesRuleSetの利用が推奨されている  
 3. ACM  
 AWS Certificate AWSManagedRulesRuleSet  
 SSL証明書を発行するマネージドサービス  
 ELBやCloudFrontにアタッチし通信を暗号化する  
 パブリック証明書発行には、ドメインが申請者の持ち主であるか確認が必要となる  
 Route53と連携してドメイン取得やEメールでの本人確認もある  
 アタッチ後は、ALBはリスナールール、CloudFrontはビューワプロトコルポリシーでHTTP限定のSSL通信設定が必須  
 4. Amazon Inspector  
 脆弱性のスキャンを行うサービスで、EC2やECR向けである  
 自動修復機能はないので、発見した後の対処が重要  
 5. AWS Security Hub  
 AWSの設定情報を検索して、脆弱な部分を指摘してくれるほか、業界基準に準拠しているかを確認してくれる  
 考慮漏れしていた設定を見直すことが可能だが、コストが高め  

### 認証情報の流出  
+ AWSに限定すればIAMユーザーやアクセスキーのことを指すが、アプリケーションの場合は管理者ページやログイン情報、DBへの接続情報が該当すると言える  
 1. KMS  
 AWSの暗号鍵マネージドサービス  
 EBS、S3等の透過的暗号化（自動暗号複合化の仕組み）  
 ファイルや文字列も暗号化可能で、鍵自体がIAMポリシーとキーポリシーの２重で権限管理されているので、鍵の利用権限がないと複合が出来ないことも利点  
 2. Secrets Manager  
 秘匿必要情報をKMSで暗号化して安全に保管、呼び出しするサービス  
 シークレットめいと設定キーでバリュー取り出しをするが、実際は開発キットでアプリケーションコードに取り出しの仕組みを実装する  
 RDS限定でDBパスワードの定期変更が可能  

### 人為的な過負荷  
+ 通常利用で発生する一時的負荷にはAutoScaling等で対応可能だが、本来想定されないDDoS攻撃のような負荷は受け止めるのではなく、ブロックすべきである  
 1. Shield  
   DDoS攻撃からインフラを保護するマネージドサービス  
   **Standard**と**Advanced**の２プランがあり、前者は無料で適用されており、インターネットと接する主要なサービスをサポートしている  
   Advancedには**ALB**が追加され、DDoS攻撃疑い情報の通知、専任チームの待機、等があるが金額はかなり高額  

### その他  
+ IAM Access Analizer  
各種ポリシーのチェックを行い、大きな権限を与えていないかを確認するもの  
S3、IAMロール、KMS、Lambda、SQS、SecretsManagerが対応  
IAM Access Advisorは利用履歴から最適案を提案してくれるもの  
+ Guard Duty  
セキュリティインシデントの疑いがあるイベントについて指摘してくれる  
AI管理のため低コストでサービスが提供されている  
オプションでS3のイベントチェックも可能  


## 感想等  
+ 最近では自分で使うアプリケーションやソフトウェア自体のセキュリティレベルが上がっているため、能動的に対策することが少ない現状ではあるが、なぜ対策されて守られているのか理由を知り、どのように守られているのか手段を知ることも重要だと感じた  
+ 講義内で、例えばアプリケーションの最強の対策はインターネットからの遮断だとする場面もあったが、実際はそういうわけにもいかないので、クライアントのコストや要望、利用者等の利便性、それらを維持しつつ想定されるリスクに対するセキュリティ対策という全てを勘案し、事業責任者と合意に至ることが理想とのことだが、これらがすんなりいくはずも無いと思うので、インフラエンジニアとして、根拠ある提案、対策に適したサービスの把握等、可能な限り前記各当事者の意見が反映されたものを目指せるよう、日々研鑽が重要だと再認識  

### 少し疑問
+ 課題を進めていくプラス認定資格の勉強をする中で、AWSには本当に多くのサービスがあり、各サービスでも事細かく機能があったりするので、全サービスの機能や知識を網羅しているAWS担当者はいるのか？（当然、いるのはいるのでしょうが）いても全サービスの知識を駆使するポジションはあるのか？と疑問に思いました。  
自分の現在の仕事は、入社して研修後→基礎基本であり稼働人員も最多数の部門で勤務、数年して希望する部門→部門ごとに異なる専門知識を習得していく（ここで今後のキャリアに大きく影響する→昇任して短期間だけ他部門へいくことはあっても、すぐに自分の専門部門に戻る、昇任する度に退職までこれを繰り返す）といった具合なのですが、AWSエンジニアも入る会社や会社内で勤務する部門によってなんとなく自分の得意とする分野やサービスが決まっていくのような感じでしょうか。（もちろん、自分がどういったサービスを担当したいかということも重要だとは思っています）  
自分の現職では、他部門の仕事もなんとなく知ってはいますが、いざそれを担当しろと言われても完全に素人なので、１からの習得になります。
EC2、RDS、S3、IAM等々、全AWSエンジニアが抑えるべき技術が大前提としてあるのは理解していますが、ロボットやサテライトに関するサービスは利用するユーザーが限られているのでは？と思っていて、ゲーム開発やマシンラーニング、IoT、ブロックチェーン等も深く知る人はAWSエンジニアの母数からすると少数なのだろうと想像しています。  
本課題から逸れて長々と書いてしまいましたが、要約すると**転職先や派遣先で担当する仕事によって自分が得意とするAWSサービスに偏りが出ることは自然なこと**、**様々な技術に触れて自分の強みとするサービスを深く習得していく**、という認識で合っているでしょうか。  
それでも、あくまでインフラサービスなのでIAMでのアカウント管理やEC2、RDS、S3等を利用して仕事すること（現在もしている人）が大多数なのだろうとは思っていますが、今後のためにも１つの認識として教えていただけたらなと思っています。
